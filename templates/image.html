<html lang="en" data-bs-theme="dark">
<head>
    <title>{{ site_title }} | {{ image_id }}</title>
    <script src="{{ url_for('static', path='/bootstrap/1756173047/bootstrap.bundle.min.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', path='/bootstrap/1756173047/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}">
    <link rel="shortcut icon" href="{{ url_for('get_favicon') }}">
</head>
<body>
    <div class="container-fluid text-center">
        <h1 class="pt-3 mt-4">{{ site_title }}</h1>
        <div class="row align-items-center">
            <div class="mt-2">
                <a href="{{ url_for('api_get_image', image_id=image_id) }}">
                    <img id="image" class="rounded" alt="Image {{ image_id }}" />
                </a>
            </div>
            <div class="mt-3">
                <a id="download" role="button" class="btn btn-outline-primary" download="{{ image_filename }}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                    </svg> Current ({{ resolution_data.current_width }}x{{ resolution_data.current_height }})
                </a>
                <a role="button" class="btn btn-outline-primary" 
                   href="{{ url_for('api_get_image', image_id=image_id).include_query_params(download=True) }}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                    </svg> Original ({{ resolution_data.original_width }}x{{ resolution_data.original_height }})
                </a>
                <a role="button" class="btn btn-secondary"
                    href="{{ url_for('page_get_image', image_id=image_id) }}">
                    {%- include 'svg/bi-link-45deg.svg' -%} Permalink
                </a>
                <a id="clipboard-link" role="button" class="btn btn-secondary">
                    {%- include 'svg/bi-link-45deg.svg' -%} Copy permalink
                </a>
                <a href="{{ url_for('page_redirect_rand_image') }}" role="button" class="btn btn-primary">
                    {%- include 'svg/bi-dice-3.svg' -%} Random
                </a>
            </div>
            <div class="mt-2 pt-2">
                <code>Image ID: {{ image_id }}</code>
            </div>
        </div>
    </div>

    <script>
        window.addEventListener("load", (event) => {
            document.getElementById('clipboard-link').addEventListener("click", async (e) => {
                try {
                    await navigator.clipboard.writeText('{{ url_for('page_get_image', image_id=image_id) }}');
                    e.srcElement.classList.remove("btn-secondary");
                    e.srcElement.classList.add("btn-success");
                    await new Promise(r => setTimeout(r, 1000));
                    e.srcElement.classList.remove("btn-success");
                    e.srcElement.classList.add("btn-secondary");
                } catch (err) {
                    console.error('Failed to copy: ', err);
                }
            });
        });

        const imageUrl = "{{ url_for('api_get_image', image_id=image_id).include_query_params(width=resolution_data.current_width) }}";

        fetch(imageUrl)
            .then(res => res.blob())
            .then(blob => {
                const blobUrl = URL.createObjectURL(blob);

                document.getElementById("image").src = blobUrl;

                const downloadLink = document.getElementById("download");
                downloadLink.href = blobUrl;
            })
            .catch(err => console.error("Error loading image:", err));
    </script>

    <footer class="pt-2 mt-2 text-center text-body-secondary fw-light">
        <p>Powered by <a href="https://github.com/das-kaesebrot/randimg" class="text-reset">randimg</a> version <code>{{ version }}</code></p>
    </footer>
</body>
</html>
